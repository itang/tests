# Generated by Buildr 1.4.21, change to your liking

# Version number for this release
VERSION_NUMBER = "1.0.0"
# Group identifier for your projects
GROUP = "test-buildr"
COPYRIGHT = ""

DIST = "dist"
DIST_LIB = DIST + "/lib"
DIST_RUN_FILE = "#{DIST}/run.sh"

Project.local_task :dist

# Specify Maven 2.0 remote repositories here, like this:
repositories.remote << "http://repo1.maven.org/maven2"

desc "The Test-buildr project"
define "test-buildr" do

  project.version = VERSION_NUMBER
  project.group = GROUP
  manifest["Implementation-Vendor"] = COPYRIGHT

  package :jar
  compile.with 'commons-cli:commons-cli:jar:1.2'
  compile.with 'joda-time:joda-time:jar:2.7'

  compile.options.source = '1.8'
  compile.options.target = '1.8'

  run.using :main => "Main"

  task :clean_dist do
     puts "clean_dist"
     system "rm -rf #{DIST}"
  end

  task :dist => [:clean_dist, :package] do
    system 'date'
    puts project.compile.dependencies
    puts (project.compile.dependencies).class

    system "mkdir -p #{DIST_LIB}"
    project.compile.dependencies.each do |x|
       system "cp #{x} #{DIST_LIB}"
    end
    system "cp target/test-buildr-1.0.0.jar #{DIST_LIB}"

    run_shell = <<-eos
    #!/bin/bash

    java -cp .:lib/* Main
    eos

    File.open(DIST_RUN_FILE, 'w') { |f| f.write(run_shell) }

    system "tree #{DIST}"
    system "chmod +x #{DIST_RUN_FILE}"
  end
end
